{% extends 'base.html' %}
{% block title %}Leaderboards Â· {{ APP_NAME or "Ball Knowledge" }}{% endblock %}

{% block content %}
<div class="mx-auto max-w-screen-md px-3 pt-4 pb-[max(1rem,env(safe-area-inset-bottom))]">

  <div class="bg-slate-800 border border-slate-700 rounded-xl shadow-lg">
    <div class="px-5 pt-4 pb-2 border-b border-slate-700 text-center">
      <h2 class="text-lg font-semibold text-slate-100">Leaderboards</h2>
      <p class="text-xs text-slate-400">Daily ({{ today_label }}), Timed Top 10, Daily All-Time</p>
    </div>

    <div class="px-3 py-2 flex items-center justify-center gap-2">
      <a href="{{ url_for('main.leaderboards', tab='daily') }}"
         class="px-3 py-1.5 rounded-lg border text-sm font-semibold
                {% if active=='daily' %}bg-indigo-600 text-white border-indigo-600{% else %}text-slate-300 border-slate-600 hover:bg-slate-700{% endif %}">
        Daily
      </a>
      <a href="{{ url_for('main.leaderboards', tab='timed') }}"
         class="px-3 py-1.5 rounded-lg border text-sm font-semibold
                {% if active=='timed' %}bg-indigo-600 text-white border-indigo-600{% else %}text-slate-300 border-slate-600 hover:bg-slate-700{% endif %}">
        Timed
      </a>
      <a href="{{ url_for('main.leaderboards', tab='alltime') }}"
         class="px-3 py-1.5 rounded-lg border text-sm font-semibold
                {% if active=='alltime' %}bg-indigo-600 text-white border-indigo-600{% else %}text-slate-300 border-slate-600 hover:bg-slate-700{% endif %}">
        Daily All-Time
      </a>
    </div>

    <div class="p-5">

      <div {% if active!='daily' %}class="hidden"{% endif %}>
        {% if daily_rows and daily_rows|length > 0 %}
            <ol class="space-y-1">
            {% for r in daily_rows %}
                <li class="flex items-center justify-between border-b border-slate-700 px-3 py-2">
                <span class="font-medium text-slate-200 flex items-center gap-2">
                    {{ loop.index }}. {{ r.username }}
                    {% if r.cheated %}
                    <span class="inline-flex items-center rounded-full bg-rose-900/40 text-rose-300 px-2 py-0.5 text-[11px] border border-rose-800 font-semibold">
                        CHEATED
                    </span>
                    {% endif %}
                </span>
                <span class="text-white font-semibold">{{ r.score }}</span>
                </li>
            {% endfor %}
            </ol>

            <!-- Cheated disclaimer -->
             {% if active == 'daily' and (daily_rows|selectattr('cheated')|list|length) %}
                <div class="mt-3 rounded-md bg-slate-800/60 border border-slate-700 px-3 py-2 text-[9px] text-slate-400">
                <div class="flex items-start gap-2">
                    <svg viewBox="0 0 20 20" fill="currentColor" class="h-3 w-3 shrink-0 text-slate-300 mt-0.5">
                    <path d="M10 2a8 8 0 100 16 8 8 0 000-16Zm1 11H9V9h2v4Zm0-6H9V5h2v2Z"/>
                    </svg>
                    <p>
                    <span class="font-semibold text-rose-300">CHEATED</span> appears when your browser/tab went to the background during a Daily round.
                    Your score still counts but is flagged. It is impossible to tell what page the user switched to therefore, any switch will be 
                    assumed as cheating. Calls, app switching, or low-power mode on phones may trigger this as well.
                    </p>
                </div>
                </div>
            {% endif %}
  {% else %}
    <p class="text-center text-slate-400">No scores yet for today.</p>
  {% endif %}
</div>
    


      <div {% if active!='timed' %}class="hidden"{% endif %}>
        {% if timed_rows and timed_rows|length > 0 %}
          <ol class="space-y-1">
            {% for r in timed_rows %}
              <li class="flex items-center justify-between border-b border-slate-700 px-3 py-2">
                <span class="font-medium text-slate-200">{{ loop.index }}. {{ r.username }}</span>
                <span class="text-white font-semibold">{{ r.score }}</span>
              </li>
            {% endfor %}
          </ol>
        {% else %}
          <p class="text-center text-slate-400">No timed scores yet.</p>
        {% endif %}
      </div>

      <div {% if active!='alltime' %}class="hidden"{% endif %}>
        {% if alltime_rows and alltime_rows|length > 0 %}
          <ol class="space-y-1">
            {% for r in alltime_rows %}
              <li class="flex items-center justify-between border-b border-slate-700 px-3 py-2">
                <span class="font-medium text-slate-200">
                    {{ loop.index }}. {{ r.username }}
                    {% if r.streak and r.streak|int >= 3 %}
                    <span class="ml-2 inline-flex items-center rounded-full bg-emerald-900/40 text-emerald-300 px-2 py-0.5 text-[11px] border border-emerald-800 font-semibold">
                        {{ r.streak }} ðŸ”¥
                    </span>
                    {% endif %}
                </span>
                <span class="text-white font-semibold">{{ r.total_score }}</span>
                </li>

            {% endfor %}
          </ol>
        {% else %}
          <p class="text-center text-slate-400">No all-time totals yet.</p>
        {% endif %}
      </div>

    </div>
  </div>
</div>
{% endblock %}